# API Fournisseur CG - Documentation ComplÃ¨te

## Qu'est-ce que l'API Fournisseur CG ?

L'API Fournisseur CG est un **wrapper et orchestrateur central** dÃ©veloppÃ© avec AdonisJS qui sert de couche d'intÃ©gration entre les applications clientes (web Vue.js et mobile) et l'infrastructure backend complexe de la plateforme logistique Fournisseur Congo.

```ts
// Exemple d'utilisation de l'API
const response = await fetch('/api/v1/orders/estimate', {
  method: 'POST',
  headers: { 'Authorization': 'Bearer token' },
  body: JSON.stringify({
    product: 'iPhone 15',
    destination: 'Brazzaville',
    weight: 0.5
  })
})
```

## DÃ©marrage Rapide

Pour configurer l'API Fournisseur CG :

```bash
# Cloner le projet
git clone https://github.com/fournisseur-cg/api.git

# Installation des dÃ©pendances
pnpm install

# Configuration de l'environnement
cp .env.example .env

# DÃ©marrage en dÃ©veloppement
pnpm dev
```

## Architecture et RÃ´le

### ğŸ¯ **RÃ´le Principal : Wrapper/Orchestrateur**
- **Couche d'abstraction** entre clients et services backend
- **Orchestrateur** des opÃ©rations complexes multi-services
- **Gestionnaire** des permissions et sÃ©curitÃ© avancÃ©e
- **Pont** pour opÃ©rations impossibles cÃ´tÃ© client

### ğŸ—ï¸ **Services IntÃ©grÃ©s**
- **Appwrite** (Backend principal, self-hosted)
- **MailerSend** (Emails marketing et notifications)
- **SMTP** (Messages systÃ¨me et bienvenue)
- **Spark Pay API** (Paiements mobiles Congo)

### ğŸ”Œ **Clients SupportÃ©s**
- Application mobile native
- Site web Vue.js 3
- Interface d'administration
- Services externes via webhooks

## Services Backend IntÃ©grÃ©s

### ğŸ—„ï¸ **Appwrite (Backend Principal)**
- Alternative open-source Ã  Firebase
- Self-hosted pour contrÃ´le total
- Gestion des collections et documents
- Authentification multi-providers
- Stockage de fichiers sÃ©curisÃ©

```ts
// IntÃ©gration Appwrite via l'API
POST /api/v1/appwrite/collections/{collectionId}/documents
GET /api/v1/appwrite/users/{userId}/orders
PATCH /api/v1/appwrite/documents/{documentId}
```

### ğŸ“§ **MailerSend (Emails Marketing)**
- Campagnes email automatisÃ©es
- Notifications de commandes
- Templates personnalisÃ©s
- Analytics des emails
- Gestion des listes de diffusion

```ts
// Services email via l'API
POST /api/v1/emails/marketing/send
POST /api/v1/emails/notifications/order-status
GET /api/v1/emails/templates
```

### ğŸ“® **SMTP (Messages SystÃ¨me)**
- Messages de bienvenue
- Notifications de formulaires
- Confirmations d'actions
- Alertes systÃ¨me
- Communications transactionnelles

### ğŸ’³ **Spark Pay API (Paiements)**
- IntÃ©gration MTN Money
- Support Airtel Money
- Gestion des transactions
- Webhooks de confirmation
- Historique des paiements

```ts
// Paiements via l'API
POST /api/v1/payments/initiate
GET /api/v1/payments/{transactionId}/status
POST /api/v1/payments/webhooks/spark-pay
```

## Types d'Utilisateurs et Permissions

### ğŸ‘¤ Visiteur (@visitor)
- Consultation des services publics
- Estimation de frais de transport
- AccÃ¨s aux informations tarifaires
- Demandes de devis sans authentification

### ğŸ›’ Client Particulier (@shopper)
- Commandes personnelles
- Suivi des colis
- Gestion du profil
- Historique des achats

### ğŸ’¼ Client Professionnel (@customer)
- Importations commerciales
- Devis personnalisÃ©s
- Gestion des Ã©quipes
- Rapports dÃ©taillÃ©s

### ğŸ”§ Administrateur (@admin)
- Gestion complÃ¨te des utilisateurs
- Configuration des services
- Monitoring des opÃ©rations
- AccÃ¨s aux analytics

## Endpoints Principaux

### ğŸ” **Authentification**
```
POST /api/v1/auth/login
POST /api/v1/auth/register
POST /api/v1/auth/refresh
DELETE /api/v1/auth/logout
```

### ğŸ“¦ **Gestion des Commandes**
```
GET /api/v1/orders
POST /api/v1/orders
GET /api/v1/orders/{id}
PATCH /api/v1/orders/{id}
DELETE /api/v1/orders/{id}
```

### ğŸšš **Services de Transport**
```
POST /api/v1/shipping/estimate
GET /api/v1/shipping/tracking/{trackingId}
POST /api/v1/shipping/book
GET /api/v1/shipping/rates
```

### ğŸ‘¥ **Gestion Utilisateurs**
```
GET /api/v1/users
POST /api/v1/users
GET /api/v1/users/{id}
PATCH /api/v1/users/{id}
DELETE /api/v1/users/{id}
```

### ğŸ’° **Paiements**
```
POST /api/v1/payments/initiate
GET /api/v1/payments/{id}
POST /api/v1/payments/confirm
GET /api/v1/payments/methods
```

## IntÃ©grations Externes

### ğŸŒ **Partenaires de Transport**
- **DHL Express** - Livraison rapide internationale
- **FedEx** - Services express et standard
- **UPS** - Logistique globale
- **Partenaires locaux** - Livraison derniÃ¨re mile

### ğŸ›’ **Plateformes E-commerce**
- **Amazon** - Importation produits US/EU
- **AliExpress** - Produits asiatiques
- **Shein** - Mode et accessoires
- **Cdiscount** - Marketplace franÃ§aise

### ğŸ’³ **Services de Paiement**
- **MTN Money** - Paiement mobile principal
- **Airtel Money** - Alternative mobile
- **Spark Pay** - AgrÃ©gateur de paiement
- **Banques locales** - Virements traditionnels

## SÃ©curitÃ© et ConformitÃ©

### ğŸ”’ **Authentification AvancÃ©e**
- JWT tokens avec refresh
- OAuth 2.0 multi-providers
- Rate limiting par endpoint
- Validation des permissions

### ğŸ›¡ï¸ **Protection des DonnÃ©es**
- Chiffrement AES-256
- ConformitÃ© RGPD
- Audit trail complet
- Sauvegarde automatique

### ğŸ” **Monitoring et Logs**
- Sentry pour error tracking
- Logs structurÃ©s JSON
- MÃ©triques de performance
- Alertes automatisÃ©es

## Webhooks et Ã‰vÃ©nements

### ğŸ“¡ **Webhooks Entrants**
```
POST /api/v1/webhooks/spark-pay
POST /api/v1/webhooks/shipping-updates
POST /api/v1/webhooks/appwrite-events
```

### ğŸ“¤ **Ã‰vÃ©nements Sortants**
- Notifications de statut commande
- Confirmations de paiement
- Alertes de livraison
- Updates de tracking

## Performance et ScalabilitÃ©

### âš¡ **Optimisations**
- Cache Redis pour sessions
- Pagination automatique
- Lazy loading des relations
- Compression des rÃ©ponses

### ğŸ“Š **Monitoring**
- Health checks automatiques
- MÃ©triques temps de rÃ©ponse
- Surveillance des erreurs
- Alertes de disponibilitÃ©

## Commandes Adonis Disponibles

### ğŸ› ï¸ **GÃ©nÃ©ration Automatique**
```bash
# GÃ©nÃ©rer un contrÃ´leur
node ace make:controller OrderController

# GÃ©nÃ©rer un modÃ¨le
node ace make:model Order

# GÃ©nÃ©rer un middleware
node ace make:middleware AuthMiddleware

# GÃ©nÃ©rer un service provider
node ace make:provider AppwriteProvider
```

### ğŸ—„ï¸ **Base de DonnÃ©es**
```bash
# CrÃ©er une migration
node ace make:migration create_orders_table

# ExÃ©cuter les migrations
node ace migration:run

# Rollback des migrations
node ace migration:rollback
```

## Variables d'Environnement

### ğŸ”§ **Configuration Appwrite**
```env
APPWRITE_ENDPOINT=https://appwrite.fournisseur.cg
APPWRITE_PROJECT_ID=fournisseur-cg
APPWRITE_API_KEY=your_server_api_key
```

### ğŸ“§ **Configuration Email**
```env
MAILERSEND_API_KEY=your_mailersend_key
SMTP_HOST=smtp.fournisseur.cg
SMTP_USERNAME=noreply@fournisseur.cg
```

### ğŸ’³ **Configuration Paiements**
```env
SPARK_PAY_API_KEY=your_spark_pay_key
SPARK_PAY_SECRET=your_spark_pay_secret
SPARK_PAY_WEBHOOK_SECRET=webhook_secret
```

## Cas d'Usage Techniques

### ğŸ”„ **Synchronisation Appwrite**
L'API permet de synchroniser les donnÃ©es entre Appwrite et les clients :
- OpÃ©rations CRUD avancÃ©es impossibles cÃ´tÃ© client
- Gestion des permissions complexes
- Validation mÃ©tier cÃ´tÃ© serveur
- Audit et logging des modifications

### ğŸ“Š **AgrÃ©gation de DonnÃ©es**
Combinaison de donnÃ©es de multiple sources :
- Informations commandes (Appwrite)
- Status paiements (Spark Pay)
- Tracking colis (partenaires transport)
- Analytics utilisateur

### ğŸ”” **Notifications Intelligentes**
Orchestration des notifications multi-canaux :
- Emails via MailerSend
- SMS via partenaires locaux
- Push notifications mobiles
- Webhooks vers systÃ¨mes tiers

## Roadmap Technique

### Phase 1 : Infrastructure (Actuelle)
- âœ… Configuration AdonisJS
- ğŸ”„ IntÃ©gration Appwrite
- ğŸ“… Services providers
- ğŸ“… Authentification JWT

### Phase 2 : Services Core
- ğŸ“… Gestion des commandes
- ğŸ“… IntÃ©gration paiements
- ğŸ“… Services de transport
- ğŸ“… SystÃ¨me de notifications

### Phase 3 : FonctionnalitÃ©s AvancÃ©es
- ğŸ“… Analytics et reporting
- ğŸ“… IA pour optimisation
- ğŸ“… API publique documentÃ©e
- ğŸ“… SDK pour dÃ©veloppeurs

## Support et Maintenance

### ğŸ”§ **Environnements**
- **Development** : http://localhost:3333
- **Staging** : https://staging-api.arkelys.cloud
- **Production** : https://api.arkelys.cloud

### ğŸ“š **Documentation**
- API Documentation (Swagger UI)
- Guides d'intÃ©gration
- Exemples de code
- Postman collections

### ğŸš¨ **Support Technique**
- Monitoring 24/7
- Alertes automatisÃ©es
- Support dÃ©veloppeur dÃ©diÃ©
- SLA 99.9% uptime

## MÃ©triques et KPIs

### ğŸ“ˆ **Performance**
- **Temps de rÃ©ponse** : < 200ms (95e percentile)
- **DisponibilitÃ©** : 99.9% SLA
- **Throughput** : 10,000+ requÃªtes/minute
- **Erreurs** : < 0.1% taux d'erreur

### ğŸ‘¥ **Utilisation**
- **10,000+** utilisateurs actifs
- **50,000+** requÃªtes/jour
- **5,000+** commandes traitÃ©es/mois
- **98%** satisfaction dÃ©veloppeur

## Contact et Ressources

### ğŸ“ **Support Technique**
- **Email** : dev@fournisseur.cg
- **Slack** : #api-support
- **Documentation** : https://docs-api.arkelys.cloud
- **Status Page** : https://status.fournisseur.cg

### ğŸ”— **Liens Utiles**
- [Repository GitHub](https://github.com/fournisseur-cg/api)
- [Swagger Documentation](https://api.arkelys.cloud/docs)
- [Postman Collection](https://postman.fournisseur.cg)
- [SDK JavaScript](https://npm.fournisseur.cg)

---

*API Fournisseur CG - L'orchestrateur technique de votre logistique internationale*

*DerniÃ¨re mise Ã  jour : Janvier 2024*
